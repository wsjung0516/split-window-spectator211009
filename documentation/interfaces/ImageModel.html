<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>split-window-spectator211009 documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">split-window-spectator211009 documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li
  >
  ImageModel</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/carousel/carousel-main/carousel-main.component.ts</code>
        </p>




        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#blob" 
>
                                            blob
                                        </a>
                                </li>
                                <li>
                                        <a href="#category" 
>
                                            category
                                        </a>
                                </li>
                                <li>
                                        <a href="#imageId" 
>
                                            imageId
                                        </a>
                                </li>
                                <li>
                                        <a href="#title" 
>
                                            title
                                        </a>
                                </li>
                                <li>
                                        <a href="#url" 
>
                                            url
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="blob"></a>
                                        <span class="name "><b>blob</b>
                                            <a href="#blob">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>blob:         <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="category"></a>
                                        <span class="name "><b>category</b>
                                            <a href="#category">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>category:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="imageId"></a>
                                        <span class="name "><b>imageId</b>
                                            <a href="#imageId">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>imageId:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="title"></a>
                                        <span class="name "><b>title</b>
                                            <a href="#title">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>title:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="url"></a>
                                        <span class="name "><b>url</b>
                                            <a href="#url">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>url:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import {
  AfterViewInit,
  ChangeDetectionStrategy,
  ChangeDetectorRef,
  Component,
  ElementRef,
  HostListener,
  Input,
  OnDestroy,
  OnInit,
  ViewChild
} from &#x27;@angular/core&#x27;;
import {CarouselService} from &quot;../carousel.service&quot;;
import {ImageService} from &quot;../image.service&quot;;
import {defer, EMPTY, Observable, of, Subject, zip} from &quot;rxjs&quot;;
import {Select, Store} from &quot;@ngxs/store&quot;;
import {StatusState} from &quot;../../../store/status/status.state&quot;;
import {
  SetCurrentSplitOperation,
  SetImageUrls,
  SetIsImageLoaded,
  SetSelectedSplitWindowId,
  SetSplitAction,
} from &quot;../../../store/status/status.actions&quot;;
import {filter, skip, switchMap, take, takeUntil} from &quot;rxjs/operators&quot;;
import {SelectSnapshot} from &quot;@ngxs-labs/select-snapshot&quot;;
import {SeriesItemService} from &quot;../../thumbnail/series-item/series-item.service&quot;;
import {CacheSeriesService} from &quot;../../thumbnail/cache-series.service&quot;;
import {fromWorker} from &quot;observable-webworker&quot;;
import {SplitService} from &quot;../../grid/split.service&quot;;

// export const category_list &#x3D; [&#x27;animal&#x27;, &#x27;house&#x27;, &#x27;baby&#x27;, &#x27;forest&#x27;, &#x27;happiness&#x27;, &#x27;love&#x27;, &#x27;sea&#x27;,&#x27;banana&#x27;, &#x27;mountain&#x27;]
export interface ImageModel {
  imageId: number,
  category: string,
  url: string,
  blob: any,
  title: string
}

@Component({
  selector: &#x27;app-carousel-main&#x27;,
  template: &#x60;
    &lt;div&gt;
      &lt;div class&#x3D;&quot;w-auto h-auto&quot;&gt;
        &lt;div class&#x3D;&quot;m-1&quot;&gt;
          &lt;mat-progress-bar mode&#x3D;&quot;determinate&quot; [value]&#x3D;&quot;progress[categoryIdx]&quot;&gt;&lt;/mat-progress-bar&gt;
        &lt;/div&gt;

        &lt;div class&#x3D;&quot;&quot;&gt;
          &lt;div class&#x3D;&quot;m-1&quot;&gt;
            &lt;img class&#x3D;&quot;object-scale-down&quot; #img&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;

  &#x60;,
  styles: [],
  changeDetection: ChangeDetectionStrategy.OnPush

})
export class CarouselMainComponent implements OnInit, AfterViewInit, OnDestroy {
  @Input() set queryElement(el: string) {
    let idx;
    if (el &#x3D;&#x3D;&#x3D; &#x27;element1&#x27;) idx &#x3D; 0;
    if (el &#x3D;&#x3D;&#x3D; &#x27;element2&#x27;) idx &#x3D; 1;
    if (el &#x3D;&#x3D;&#x3D; &#x27;element3&#x27;) idx &#x3D; 2;
    if (el &#x3D;&#x3D;&#x3D; &#x27;element4&#x27;) idx &#x3D; 3;

    this.makingSplitWindowByGrid(idx);
  }

  @ViewChild(&#x27;img&#x27;) image: ElementRef;
  // to check if image loading is started from webworker.
  @Select(StatusState.getIsImageLoaded) getIsImageLoaded$: Observable&lt;any&gt;;
  @Select(StatusState.getSelectedImageById) getSelectedImageById$: Observable&lt;ImageModel&gt;;
  @Select(StatusState.getSelectedSeriesById) getSelectedSeriesById$: Observable&lt;number&gt;;
  //
  @SelectSnapshot(StatusState.getSplitState) getSplitState: string[];
  @SelectSnapshot(StatusState.getCurrentCategory) currentCategory: string;
  @SelectSnapshot(StatusState.getCategoryList) category_list: string[];
  @SelectSnapshot(StatusState.getWebworkerWorkingStatus) getWebworkerWorkingStatus: boolean;
  @Select(StatusState.getSeriesUrls) getSeriesUrls$: Observable&lt;any&gt;;
  @Select(StatusState.getSplitMode) splitMode$: Observable&lt;any&gt;;
  @SelectSnapshot(StatusState.getSplitMode) splitMode: number;
  @SelectSnapshot(StatusState.getSplitAction) splitAction: boolean;
  @SelectSnapshot(StatusState.getFocusedSplit) focusedSplitIdx: number;
  @Select(StatusState.getCurrentSplitOperation) getCurrentSplitOperation$: Observable&lt;{}&gt;;
  @Select(StatusState.getActiveSplit) activeSplit$: Observable&lt;number&gt;;
  worker: Worker[] &#x3D; [];
  unsubscribe &#x3D; new Subject();
  unsubscribe$ &#x3D; this.unsubscribe.asObservable();
  _queryUrl: string;
  category: string;
  splitIdx: number;
  categoryIdx: any;
  imageCount: any[] &#x3D; [];
  progress: string[] &#x3D; [];
  originalImage: any;
  requestRenderingSplitWindow$: Observable&lt;string&gt;[] &#x3D; [];
  selectedSplitWindow &#x3D; new Subject&lt;string&gt;();
  tempObservable: Observable&lt;any&gt;;

  @HostListener(&#x27;window:keydown&#x27;, [&#x27;$event&#x27;])
  handleKey(event: KeyboardEvent) {
    if (event.key &#x3D;&#x3D;&#x3D; &#x27;ArrowRight&#x27;) this.nextImage();
    if (event.key &#x3D;&#x3D;&#x3D; &#x27;ArrowLeft&#x27;) this.prevImage();
    // console.log( &#x27;key value&#x27;,event.key);
  }

  constructor(
    private carouselService: CarouselService,
    private imageService: ImageService,
    private store: Store,
    private splitService: SplitService,
    private cdr: ChangeDetectorRef,
    private seriesItemService: SeriesItemService,
    private cacheSeriesService: CacheSeriesService,
  ) {}


  ngOnInit(): void {
    // call from thumbnail-list, triggered by clicking image item.
    this.splitWindowProcess1();
    this.splitWindowProcess2()

    /** Display image at the main window whenever clinking thumbnail_item */
    this.getSelectedImageById$.pipe(skip(1))
      .subscribe(image &#x3D;&gt; {
        const img &#x3D; this.carouselService.getSelectedImageById(image.category, image.imageId)
        this.displaySplitWindowImage(img);
      })

    /** New process start whenever clinking series_item */
    this.getSelectedSeriesById$.pipe(
      skip(1),
      takeUntil(this.unsubscribe$),
    ).subscribe((id: number) &#x3D;&gt; {
      this.makingSplitWindowBySelectedSeries(id);
    });
  }

  private makingSplitWindowByGrid(eIdx: number) {
    this.category &#x3D; this.getSplitState[eIdx];
    this.splitIdx &#x3D; eIdx;
    this._queryUrl &#x3D; &#x60;assets/json/${this.category}.json&#x60;;
    this.categoryIdx &#x3D; this.category_list.findIndex(val &#x3D;&gt; val &#x3D;&#x3D;&#x3D; this.category);
    this.splitService.selectedElement &#x3D; this.splitService.elements[eIdx];
    if (this.splitMode &#x3D;&#x3D;&#x3D; 1) {
       this.splitService.resetSplitWindowProcessing();
    }
    // console.log(&#x27;----requestRenderingSplitWindow$&#x27;, this.requestRenderingSplitWindow$, this.splitService.selectedElement, eIdx);
    this.requestRenderingSplitWindow$[this.splitService.selectedElement] &#x3D; of(this.splitService.selectedElement).pipe(take(1));
  }

  private makingSplitWindowBySelectedSeries(cIdx: number) {
    this.category &#x3D; this.category_list[cIdx];
    this._queryUrl &#x3D; &#x60;assets/json/${this.category}.json&#x60;;
    this.categoryIdx &#x3D; this.category_list.findIndex(val &#x3D;&gt; val &#x3D;&#x3D;&#x3D; this.category);
    this.makingSplitWindow();
  }

  private makingSplitWindow() {
    // console.log(&#x27; --- makingSplitWindow &#x27;);
    this.webWorkerProcess();
    this.getTotalImageList();
    this.makeTheFirstImage();

  }


  private makeTheFirstImage() {
    this.getIsImageLoaded$ &amp;&amp; this.getIsImageLoaded$.pipe(skip(1),take(1))
      .subscribe(async () &#x3D;&gt; {

        await this.displayTheFirstImage();
        await this.signalFinished();
      })
  }

  private async signalFinished() {
    return new Promise(resolve &#x3D;&gt; {
      this.splitService.isFinishedRendering[this.splitService.selectedElement].next(this.splitService.selectedElement)
      resolve(&#x27;&#x27;)
      setTimeout(() &#x3D;&gt; {
        if(this.worker[this.splitIdx] ) {
          this.worker[this.splitIdx].terminate();
          this.worker[this.splitIdx] &#x3D; undefined;
          // console.log(&#x27; terimnate this.worker[this.splitIdx] &#x27;, this.splitIdx)
        }
        // if(this.worker[this.splitIdx] &amp;&amp; this.splitAction ) this.worker[this.splitIdx].terminate();
        /** Because each split window has it&#x27;s own webworker, and this webworker will be remained
         *  if it is not terminated immediately */
      },5000);

    })
  }

  private async displayTheFirstImage() {
    return new Promise( resolve &#x3D;&gt; {
        this.splitService.isStartedRendering[this.splitService.selectedElement].next(this.splitService.selectedElement)
        /**
         * When change split mode, if image is not in the cached (based on category)
         * then borrow image from series list, which is already cached.
         * This technique is needed because image should be displayed immediately
         */
        const tImage &#x3D; this.carouselService.getSelectedImageById(this.category, 0);
        if( tImage ) {
          this.displaySplitWindowImage(tImage)
        } else {
          const image &#x3D; this.cacheSeriesService.getCachedSeriesByCat(this.category).blob;
          this.displaySplitWindowImage(image);
        }
        resolve(&#x27;&#x27;)
    })
  }
  private displaySplitWindowImage(image: any) {
    // console.log(&#x27;-- this.focusedSplitIdx, this.splitIdx, this.splitAction&#x27;, this.focusedSplitIdx, this.splitIdx, this.splitAction)
    if( this.splitIdx !&#x3D;&#x3D; this.focusedSplitIdx &amp;&amp; !this.splitAction) {
      return
    }
    this.image.nativeElement.src &#x3D; image;
    this.originalImage &#x3D; this.image.nativeElement.src;
    this.cdr.detectChanges();
    /** To focus on the selected split window as the first window */
    this.store.dispatch(new SetSelectedSplitWindowId(&#x27;element1&#x27;));

    /**
     * 1. In case, window is opened by split mode action,
     * 2. and user clicked arrow button,
     * 3. this time splitAction is true
     * 4. reset splitAction false when the last split window is displayed.
     * this can protect abnormal display
     * */
    if( this.splitAction &#x3D;&#x3D;&#x3D; true ) {
      const splitIdx &#x3D; this.splitService.elements.findIndex(val &#x3D;&gt; val &#x3D;&#x3D;&#x3D; this.splitService.selectedElement)
      // console.log(&#x27; splitIdx&#x27;, splitIdx);
      if( this.splitMode -1  &#x3D;&#x3D;&#x3D; splitIdx)
        this.store.dispatch(new SetSplitAction(false));
    }
    //
  }

  private getTotalImageList() {
    this.imageService.getTotalImageList(this._queryUrl)
      .subscribe((val: any) &#x3D;&gt; {
        const category &#x3D; this._queryUrl &amp;&amp; this._queryUrl.split(&#x27;.&#x27;)[0].split(&#x27;/&#x27;)[2];
        const urls &#x3D; this.imageService.getCacheUrls();
        /** Try to display if there are any cached image before check additional loading  */
        this.store.dispatch(new SetImageUrls([]));
        // console.log(&#x27; val&#x27;, val)
        this.checkIfAdditionalLoading(val, category, urls).then((res: any) &#x3D;&gt; {
          // console.log(&#x27;-- remained url&#x27;, res.length)
          if (res.length &gt; 0) { // If there is remained url that need loading image
            this.imageCount[this.categoryIdx] &#x3D; res.length;
            /** Send urls for loading images additionally */
            this.webworkerPostMessage(res);
          } else {
            /** In this case, no webworker job is needed because all images are cached,
             *  And display the first image.
             */
            this.store.dispatch(new SetIsImageLoaded({idx:0}));
            this.progress[this.categoryIdx] &#x3D; &#x27;&#x27;;
            /** Triggering loading every image, then thumbnail list is updated continuously */
            this.store.dispatch(new SetImageUrls([]));
          }

        });
      }, error &#x3D;&gt; {
        throw Error(error)
      });
  }



  checkIfAdditionalLoading(val: any, category: string, urls: { idx: number; category: string; url: string }[]) {
    /** Check if image is cached already, then skip caching job
     * or extract remained urls, which is needed loading image by using webworker */
    return new Promise((resolve, reject) &#x3D;&gt; {
      const input$ &#x3D; of({req: val, category, urls: urls});

      if (!this.splitService.bWorker) {
        this.splitService.bWorker &#x3D; new Worker(new URL(&#x27;src/assets/workers/additional-loading.worker&#x27;, import.meta.url), {type: &#x27;module&#x27;})
      }
      fromWorker&lt;{}, string[]&gt;(
        () &#x3D;&gt; this.splitService.bWorker,
        input$,
      ).subscribe(res &#x3D;&gt; {
        resolve(res)
      }, error &#x3D;&gt; reject(error))
    });
  }

  private webworkerPostMessage(val: any) {
    // console.log(&#x27; val&#x27;, val.length)
    const data: any &#x3D; {
      msg: &#x27;download&#x27;,
      body: val,
      category: this.category
    }
    /** Send additional urls to webworker */
    if(this.worker[this.splitIdx]) this.worker[this.splitIdx].postMessage(data)
    // this.worker[this.categoryIdx].postMessage(data)
  }

  ngAfterViewInit() {
  }
  nextImage() {
    if( this.splitIdx !&#x3D;&#x3D; this.focusedSplitIdx &amp;&amp; !this.splitAction) return

    const image &#x3D; this.carouselService.getNextImage(this.currentCategory, this.splitService.selectedElement);
    this.displaySplitWindowImage(image);
  }
  prevImage() {
    if( this.splitIdx !&#x3D;&#x3D; this.focusedSplitIdx &amp;&amp; !this.splitAction) return

    const image &#x3D; this.carouselService.getPrevImage(this.currentCategory, this.splitService.selectedElement);
    this.displaySplitWindowImage(image);
  }
  webWorkerProcess() {
    if (typeof Worker !&#x3D;&#x3D; &#x27;undefined&#x27;) {
      if( !this.worker[this.splitIdx]) {
        // console.log(&#x27;this.worker[this.splitIdx]&#x27;, this.worker[this.splitIdx], this.splitIdx)
        this.worker[this.splitIdx] &#x3D; new Worker(new URL(&#x27;src/assets/workers/carousel-worker.ts&#x27;, import.meta.url));
        this.worker[this.splitIdx].onmessage &#x3D; (data: any) &#x3D;&gt; {
          this.progress[this.categoryIdx] &#x3D; ((data.data.imageId + 1)/ this.imageCount[this.categoryIdx] * 100).toFixed(0).toString();
          this.makeCachedImage(data.data);
          const _data: any &#x3D; {
            msg: &#x27;completeCachedImage&#x27;,
            body: data.data.url,
            category: this.category
          }
          // console.log(&#x27; _data&#x27;,data.data.url)
          /** Send the signal of completing loading one image of all the images
           * that was sent to webworker as bundle urls
           * This means for being ready to receiving the next image*/
          this.worker[this.splitIdx].postMessage(JSON.parse(JSON.stringify(_data)))
        };
      }
    }
  }

  private makeCachedImage(data: ImageModel) {
    if(  !data.blob.type || !data.blob.size) {
      // data is not Blob type.
      return;
    }
    // console.log(&#x27;----data- category&#x27;,data.category)
    const image: any &#x3D; this.imageService.readFile(data.blob)
    image.subscribe((obj: any) &#x3D;&gt; {
      data.blob &#x3D; obj;
      this.saveCacheImage(data);
    })
  }

  saveCacheImage(data: ImageModel) {
    this.imageService.checkAndCacheImage(data)
    /** Triggering that every image is loading, then thumbnail list is updated continuously */
    this.store.dispatch(new SetImageUrls([data.url]));
    /** To show the first image in the main window */
    this.store.dispatch(new SetIsImageLoaded({idx:data.imageId}));
  }
///////////////////////////////////////////////////
  private splitWindowProcess1() {
    /**
     * When it comes to rendering of split-windows,
     * each window need to wait until the previous window finished rendering.
     * -----------------
     * 1. The end of processing of image, emit event of &quot;isStartedRendering$&quot; for each split window.
     * 2. As soon as take the event of &quot;isStartedRendering$&quot; start processing .
     * 3. display the first image and emit event of &quot;isFinishedRendering$&quot;
     *    for each split window.
     * */
      //
    const isFinished$ &#x3D; this.getCurrentSplitOperation$.pipe( // 1 To know the end of image processing
        switchMap((val:any) &#x3D;&gt; {
          this.splitService.selectedElement &#x3D; val.element; // 2
          return this.splitService.isFinishedRendering$[val.element].pipe(take(1));
        }),
        take(1), // 3
      );

    const isStarted$ &#x3D; this.getCurrentSplitOperation$.pipe( // 4 To know the start of image processing
      switchMap((val: any) &#x3D;&gt; {
        this.splitService.selectedElement &#x3D; val.element;
        return this.splitService.isStartedRendering$[val.element].pipe(take(1));
      }),
      take(1),
    );

    if (this.splitMode &gt; 1) {
      if (this.splitService.selectedElement &#x3D;&#x3D;&#x3D; &#x27;element1&#x27;) { // 5 first split window
        this.tempObservable &#x3D; defer(() &#x3D;&gt; of(EMPTY).pipe());
      } else if (this.splitService.selectedElement &#x3D;&#x3D;&#x3D; &#x27;element2&#x27;) {
        this.tempObservable &#x3D; zip(isStarted$, isFinished$).pipe( //[&#x27;element2&#x27;,&#x27;element1&#x27;]
          filter((val: any) &#x3D;&gt; val[1] &#x3D;&#x3D;&#x3D; &#x27;element1&#x27;) // 6
        );
      } else if (this.splitService.selectedElement &#x3D;&#x3D;&#x3D; &#x27;element3&#x27;) {
        this.tempObservable &#x3D; zip(isStarted$, isFinished$).pipe( //[&#x27;element3&#x27;,&#x27;element2&#x27;]
          filter((val: any) &#x3D;&gt; val[1] &#x3D;&#x3D;&#x3D; &#x27;element2&#x27;),
        );
      } else if (this.splitService.selectedElement &#x3D;&#x3D;&#x3D; &#x27;element4&#x27;) {
        this.tempObservable &#x3D; zip(isStarted$, isFinished$).pipe( //[&#x27;element4&#x27;,&#x27;element3&#x27;]
          filter((val: any) &#x3D;&gt; val[1] &#x3D;&#x3D;&#x3D; &#x27;element3&#x27;),
        );
      }
    } else {
      this.tempObservable &#x3D; defer(() &#x3D;&gt; of(EMPTY).pipe()); // 7
    }
  }
  //
  private splitWindowProcess2() {
    const rendering$: Observable&lt;any&gt; &#x3D; this.requestRenderingSplitWindow$[this.splitService.selectedElement];
    // 8
    zip(this.tempObservable, rendering$).pipe( // 9
      take(1),
    ).subscribe(([temp, element]) &#x3D;&gt; {
      /** Start processing ct-viewer after finished processing for previous split window*/
      const idx &#x3D; this.splitService.elements.findIndex(val &#x3D;&gt; val &#x3D;&#x3D;&#x3D; element)
      this.splitService.selectedElement &#x3D; element;
      /** When change split mode, need to set the first signal to prepare processing
       * because each split window do process one by one */
      this.store.dispatch(new SetCurrentSplitOperation({element: this.splitService.selectedElement}));

      this.makingSplitWindowBySelectedSeries(this.categoryIdx); // 10
    });
  }
///////////////////////////////////////////////////////

  ngOnDestroy() {
    this.unsubscribe.next();
    this.unsubscribe.complete();
  }
}
</code></pre>
    </div>
</div>







                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'ImageModel.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
